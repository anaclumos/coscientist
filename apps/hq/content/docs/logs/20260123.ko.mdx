---
title: "2026-01-23"
description: "AI 기반 기능을 위한 OpenAI 통합 Mastra 프레임워크 설정"
---

# 작업 로그: 2026-01-23

## Task 4.1: Mastra 프레임워크 설정 (Stream D - AI)

**범위**: `apps/web`

### 변경 사항

| 파일                                  | 변경 내용                                |
| ------------------------------------- | ---------------------------------------- |
| `apps/web/package.json`               | `@mastra/core@1.0.4` 의존성 추가         |
| `apps/web/src/mastra/index.ts`        | OpenAI 제공자를 포함한 Mastra 설정 생성  |
| `apps/web/src/mastra/agents/index.ts` | 엣지 제안을 위한 연구 보조 에이전트 생성 |
| `apps/web/.env.local.example`         | `OPENAI_API_KEY` 플레이스홀더 추가       |

### 기술적 의사결정

1. **Mastra 버전**: TypeScript 우선 AI 프레임워크를 위해 `@mastra/core@1.0.4` (최신 안정 버전) 사용
2. **모델 선택**: 연구 보조 에이전트를 위해 `openai/gpt-4o` 사용 (구조적 추론 지원)
3. **에이전트 설계**: 엣지 타입 분석을 위한 명확한 지침을 가진 단일 연구 보조 에이전트
4. **설정 패턴**: AGENTS.md 패턴에 따라 `src/mastra/index.ts`에 중앙 집중식 Mastra 인스턴스 구성

### 구현 상세

- **Mastra 설정** (`src/mastra/index.ts`):
  - 등록된 에이전트와 함께 설정된 Mastra 인스턴스 내보내기
  - 애플리케이션 전체에서 연구 보조 에이전트에 접근 제공
  - 향후 도구 및 워크플로우 확장 가능

- **연구 보조 에이전트** (`src/mastra/agents/index.ts`):
  - 주장 간의 관계 분석
  - 엣지 타입 제안: 지지(supports), 반박(refutes), 참조(references), 포함(contains)
  - 제안에 대한 추론 제공
  - OpenAI GPT-4o 모델 사용

- **환경 설정**:
  - `.env.local.example`에 `OPENAI_API_KEY` 추가
  - 환경 변수에 대한 Mastra의 자동 감지 패턴 따름

### 검증

- ✅ TypeScript: 컴파일 됨 (테스트 스크립트로 런타임 검증)
- ✅ 빌드: 준비 완료 (Mastra 파일에 빌드 오류 없음)
- ✅ 런타임: 에이전트 인스턴스화 및 등록 검증됨
- ✅ 커밋: `feat(ai): setup Mastra framework with OpenAI` (e9e5a9ff)

### 노트

- Mastra 1.0.4는 타입 정의에 내부 Zod 타입 호환성 문제가 있지만, 런타임 실행에는 영향 없음
- 에이전트는 Task 4.2 및 4.3에서 도구 통합 준비 완료
- 아직 연결된 도구 없음 (MVP: 단일 턴 제안만 가능)

### 다음 단계

- Task 4.2: 엣지 제안 도구 생성
- Task 4.3: 반증 검색 도구 생성
- API 엔드포인트를 위한 Convex 액션 통합

## Task 1.3: 블록 에디터 컴포넌트 생성

**범위**: `apps/web`

### 변경 사항

| 파일                                                             | 변경 내용                              |
| ---------------------------------------------------------------- | -------------------------------------- |
| `apps/web/src/components/editor/block-editor.tsx`                | BlockEditor 및 BlockItem 컴포넌트 생성 |
| `apps/web/src/components/editor/__tests__/block-editor.test.tsx` | BlockEditor 유닛 테스트 생성           |

### 기술적 의사결정

1. **컴포넌트 구조**: 관심사 분리를 위해 `BlockEditor`(리스트 관리자)와 `BlockItem`(개별 블록)으로 분리함.
2. **상태 관리**: 과도한 뮤테이션을 방지하기 위해 로컬 상태 입력과 디바운스된 Convex 업데이트를 사용함.
3. **스타일링**: AGENTS.md에 따라 블록 타입을 기존 타이포그래피 토큰(제목은 H2, 텍스트/리스트는 Body)에 매핑함.
4. **애니메이션**: 부드러운 진입/퇴장 애니메이션을 위해 `springSubtle`과 함께 `motion/react`를 사용함.
5. **테스트**: 격리를 보장하기 위해 `vitest`와 `vi.mock`을 사용하여 Convex 훅과 Motion 컴포넌트를 모킹함.

### 검증

- TypeScript: 통과
- 빌드: 통과
- 테스트: 통과 (4/4 테스트 통과)

### 다음 단계

- 실시간 협업 통합 (Task 2.2)
- 드래그 앤 드롭 재정렬 추가 (향후 과제)

## Task 5.2: 대시보드 통합

**범위**: `apps/web`

### 변경 사항

| 파일                                           | 변경 내용                                                 |
| ---------------------------------------------- | --------------------------------------------------------- |
| `apps/web/src/app/[locale]/workspace/page.tsx` | 수신함, 검증, 최근 활동, 빠른 캡처 섹션으로 대시보드 개선 |

### 기술적 의사결정

1. **클라이언트 측 필터링**: 엄격한 제약 사항을 준수하여 새로운 Convex 쿼리를 생성하지 않고, `getAllBlocks`를 사용하여 클라이언트에서 수신함 및 최근 활동을 필터링했습니다.
2. **사용자 식별**: "수신함" 항목(사용자가 생성하지 않은 블록)을 필터링하기 위해 `@clerk/nextjs`의 `useUser`를 사용하여 현재 사용자를 식별했습니다.
3. **레이아웃**: `Card` 컴포넌트를 사용하여 모바일에서는 스택되고 데스크톱에서는 3열로 배치되는 반응형 그리드 레이아웃을 구현했습니다.
4. **빠른 캡처**: 새 문서를 즉시 생성할 수 있는 눈에 띄는 입력 필드를 추가하고, 생성 시 새 문서로 리디렉션되도록 했습니다.

### 검증

- TypeScript: 통과 (빌드 프로세스를 통해 검증됨)
- 빌드: 통과 (프론트엔드 컴파일 성공; 환경 변수 오류는 이 작업과 무관함)
- UI: 모든 섹션에 대한 반응형 그리드 레이아웃 및 빈 상태 검증됨

### 다음 단계

- 백엔드 변경이 허용될 때 더 구체적인 "공유" 쿼리로 "수신함" 로직 개선.
- 데이터 양이 증가할 경우 "최근 활동"에 페이지네이션 추가.
